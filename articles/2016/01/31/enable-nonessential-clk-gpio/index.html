<!DOCTYPE html>
<html lang="en">
<head>

        <title>Pandaboard 配置gpio功能 (uboot 2016.1)</title>
        <meta charset="utf-8" />
        <link href="http://blog.kfatso.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Kage's Blog Full Atom Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="http://blog.kfatso.com/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="http://blog.kfatso.com/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="http://blog.kfatso.com/theme/pygment.css" />

        <script src="http://blog.kfatso.com/theme/js/libs/modernizr-2.6.2.min.js"></script>

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>


</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="http://blog.kfatso.com">Kage's Blog <strong>Stay Hungry, Stay Foolish.</strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>

				<li><a href="/functions/archives.html">Archives</a></li>
				<!--
					<li><a href="/functions/tags.html">Tags</a></li>
					<li><a href="/functions/archives.html">Archives</a></li>
				
				-->
              </ul>
            </div>

<section id="content" class="body">

   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="http://blog.kfatso.com/articles/2016/01/31/enable-nonessential-clk-gpio/" rel="bookmark"
                   title="Permalink to Pandaboard 配置gpio功能 (uboot 2016.1)">Pandaboard 配置gpio功能 (uboot 2016.1)</a></h2>
           
            </header>
            <footer class="post-info">
              <!--
			  <abbr class="published" title="2016-01-31T12:00:00+08:00">
                Sun 31 January 2016
              </abbr>
              <address class="vcard author">
                By <a class="url fn" href="http://blog.kfatso.com/author/kage-shen.html">Kage Shen</a>
              </address>
			  -->
			  <address class="vcard author" style="font-style:italic;margin-bottom:-10px;">
				Sun 31 January 2016
					&nbsp;&nbsp;Write By <a class="url fn" href="http://blog.kfatso.com/author/kage-shen.html">Kage Shen</a>
	
			  </address>
			  <hr />			  
            </footer><!-- /.post-info -->
            <div class="entry-content">
              <blockquote>
<h3>主要内容:</h3>
<p>很久没有更新博客了, 最近买了域名, 于是乎心血来潮, 决定更新一篇小文.<br />
其实最近在用这个板子来配置一个外设但是什么都配置不好, 比如连设置一个IO口都不行.<br />
于是乎做了一堆对比, 希望能给你们节省一些调试时间.  </p>
</blockquote>
<h3>问题发现</h3>
<p>我先在使用的是linux4.0+uboot12.1, 按照网上<a href="omappedia.org/wiki/Toggling_an_LED_on_Pandaboard_using_GPIO">Toggling_an_LED_on_Pandaboard_using_GPIO</a>介绍操作, 发现功能不能用,  </p>
<h3>查找问题</h3>
<p>因为pandaboard这个板子已经比较老了, 估计是现在的新代码支持不好, 准备用较老的软件来试试点灯,<br />
功夫不负有心人, <a href="https://wiki.gentoo.org/wiki/Pandaboard">在Gentoo的Arm项目上找到了pandaboard的支持</a>, 于是下载对应编译好的工程, 惊奇发现, 上面的实验可以了! 于是剩下的工作就是找到他们的不同处了, 通过uboot的打印发现, 他的版本号是 2011.12, 于是主要查看了,<br />
2011.12~2016.1之间关于omap的提交, 于是发现下面两位大牛的提交:  </p>
<p><a href="https://github.com/trini/u-boot/commit/f3f98bb0b8cc520e08ea2bdfc3f9cbe4e4ac29f5">ARM: OMAP4/5: Do not configure non essential pads, clocks, dplls.</a>  </p>
<div class="highlight"><pre><span></span><span class="n">ARM</span><span class="o">:</span> <span class="n">OMAP4</span><span class="o">/</span><span class="mi">5</span><span class="o">:</span> <span class="n">Do</span> <span class="n">not</span> <span class="n">configure</span> <span class="n">non</span> <span class="n">essential</span> <span class="n">pads</span><span class="o">,</span> <span class="n">clocks</span><span class="o">,</span> <span class="n">dplls</span><span class="o">.</span>

<span class="n">Currently</span> <span class="n">on</span> <span class="n">OMAP4</span><span class="o">/</span><span class="mi">5</span> <span class="n">platforms</span><span class="o">,</span> <span class="n">many</span> <span class="n">kernel</span> <span class="n">drivers</span> <span class="n">are</span> <span class="n">dependent</span>
<span class="n">upon</span> <span class="n">the</span> <span class="n">bootloaders</span> <span class="k">for</span> <span class="n">mux</span><span class="o">,</span> <span class="n">dpll</span> <span class="n">and</span> <span class="n">clock</span> <span class="n">configurations</span><span class="o">.</span>
<span class="n">This</span> <span class="n">should</span> <span class="n">not</span> <span class="n">be</span> <span class="n">the</span> <span class="k">case</span> <span class="n">and</span> <span class="n">bootloaders</span> <span class="n">should</span> <span class="kd">set</span> <span class="n">only</span> <span class="n">the</span>
<span class="n">minimum</span> <span class="n">required</span> <span class="k">for</span> <span class="n">the</span> <span class="n">uboot</span> <span class="n">functionality</span> <span class="n">and</span> <span class="n">kernel</span> <span class="n">boot</span><span class="o">.</span>

<span class="n">Note</span> <span class="n">that</span> <span class="k">this</span> <span class="k">is</span> <span class="n">going</span> <span class="n">to</span> <span class="k">break</span> <span class="n">the</span> <span class="n">kernel</span> <span class="n">drivers</span><span class="o">.</span> <span class="n">But</span> <span class="k">this</span>
<span class="k">is</span> <span class="n">the</span> <span class="n">only</span> <span class="n">way</span> <span class="n">to</span> <span class="kd">get</span> <span class="n">things</span> <span class="n">fixed</span> <span class="k">in</span> <span class="n">the</span> <span class="n">kernel</span><span class="o">.</span>

<span class="n">Signed</span><span class="o">-</span><span class="n">off</span><span class="o">-</span><span class="n">by</span><span class="o">:</span> <span class="n">R</span> <span class="n">Sricharan</span> <span class="o">&lt;</span><span class="n">r</span><span class="o">.</span><span class="na">sricharan</span><span class="err">@</span><span class="n">ti</span><span class="o">.</span><span class="na">com</span><span class="o">&gt;</span>
</pre></div>


<p><a href="https://github.com/trini/u-boot/commit/e81f63f0d2acb130df68da52e711f9178592a012">ARM: OMAP4/5: Remove dead code against CONFIG_SYS_ENABLE_PADS_ALL</a>  </p>
<div class="highlight"><pre><span></span><span class="n">ARM</span><span class="o">:</span> <span class="n">OMAP4</span><span class="o">/</span><span class="mi">5</span><span class="o">:</span> <span class="n">Remove</span> <span class="n">dead</span> <span class="n">code</span> <span class="n">against</span> <span class="n">CONFIG_SYS_ENABLE_PADS_ALL</span>

<span class="n">The</span> <span class="n">commit</span>
<span class="n">f3f98bb</span> <span class="o">:</span> <span class="s2">&quot;ARM: OMAP4/5: Do not configure non essential pads, clocks, dplls&quot;</span>
<span class="n">removed</span> <span class="n">the</span> <span class="n">config</span> <span class="n">option</span> <span class="n">aimed</span> <span class="n">towards</span> <span class="n">moving</span> <span class="n">that</span> <span class="n">stuff</span> <span class="n">into</span> <span class="n">kernel</span><span class="o">,</span> <span class="n">which</span>
<span class="n">renders</span> <span class="n">some</span> <span class="n">code</span> <span class="n">unreachable</span><span class="o">.</span> <span class="n">Remove</span> <span class="n">that</span> <span class="n">code</span><span class="o">.</span>

<span class="n">Signed</span><span class="o">-</span><span class="n">off</span><span class="o">-</span><span class="n">by</span><span class="o">:</span> <span class="n">Jassi</span> <span class="n">Brar</span> <span class="o">&lt;</span><span class="n">jaswinder</span><span class="o">.</span><span class="na">singh</span><span class="err">@</span><span class="n">linaro</span><span class="o">.</span><span class="na">org</span><span class="o">&gt;</span>
</pre></div>


<p><strong>哇... 原来是他们把"不需要的" 引脚, 时钟, 等等外设都给关闭了, 有没有想过, 我们初学者的感呢 ?<br />
他们这样一提交, 给我们造成巨大的时间损失啊!</strong>  </p>
<h3>解决问题</h3>
<p>好吧, 既然问题已经找到, 我们就把对应的补丁放上去就可以了,  </p>
<div class="highlight"><pre><span></span><span class="gh">diff --git a/arch/arm/cpu/armv7/omap-common/hwinit-common.c b/arch/arm/cpu/armv7/omap-common/hwinit-common.c</span>
<span class="gh">index 80794f9..ee43320 100644</span>
<span class="gd">--- a/arch/arm/cpu/armv7/omap-common/hwinit-common.c</span>
<span class="gi">+++ b/arch/arm/cpu/armv7/omap-common/hwinit-common.c</span>
<span class="gu">@@ -38,6 +38,7 @@ static void set_mux_conf_regs(void)</span>
        set_muxconf_regs_essential();
        break;
    case OMAP_INIT_CONTEXT_UBOOT_AFTER_SPL:
<span class="gi">+       set_muxconf_regs_non_essential();</span>
        break;
    case OMAP_INIT_CONTEXT_UBOOT_FROM_NOR:
    case OMAP_INIT_CONTEXT_UBOOT_AFTER_CH:
<span class="gh">diff --git a/arch/arm/include/asm/arch-omap4/sys_proto.h b/arch/arm/include/asm/arch-omap4/sys_proto.h</span>
<span class="gh">index f30f865..a110613 100644</span>
<span class="gd">--- a/arch/arm/include/asm/arch-omap4/sys_proto.h</span>
<span class="gi">+++ b/arch/arm/include/asm/arch-omap4/sys_proto.h</span>
<span class="gu">@@ -35,6 +35,7 @@ void watchdog_init(void);</span>
 u32 get_device_type(void);
 void do_set_mux(u32 base, struct pad_conf_entry const *array, int size);
 void set_muxconf_regs_essential(void);
<span class="gi">+void set_muxconf_regs_non_essential(void);</span>
 u32 wait_on_value(u32, u32, void *, u32);
 void sdelay(unsigned long);
 void setup_clocks_for_console(void);
<span class="gh">diff --git a/board/ti/panda/panda.c b/board/ti/panda/panda.c</span>
<span class="gh">index eb9ce63..b5021c5 100644</span>
<span class="gd">--- a/board/ti/panda/panda.c</span>
<span class="gi">+++ b/board/ti/panda/panda.c</span>
<span class="gu">@@ -286,6 +286,25 @@ void set_muxconf_regs_essential(void)</span>
               sizeof(struct pad_conf_entry));
 }

<span class="gi">+void set_muxconf_regs_non_essential(void)</span>
<span class="gi">+{</span>
<span class="gi">+    do_set_mux((*ctrl)-&gt;control_padconf_core_base,</span>
<span class="gi">+            core_padconf_array_non_essential,</span>
<span class="gi">+            sizeof(core_padconf_array_non_essential)</span>
<span class="gi">+                    / sizeof(struct pad_conf_entry));</span>
<span class="gi">+</span>
<span class="gi">+    do_set_mux((*ctrl)-&gt;control_padconf_core_base,</span>
<span class="gi">+            core_padconf_array_non_essential_4460,</span>
<span class="gi">+            sizeof(core_padconf_array_non_essential_4460)</span>
<span class="gi">+                    / sizeof(struct pad_conf_entry));</span>
<span class="gi">+</span>
<span class="gi">+    do_set_mux((*ctrl)-&gt;control_padconf_wkup_base,</span>
<span class="gi">+            wkup_padconf_array_non_essential,</span>
<span class="gi">+            sizeof(wkup_padconf_array_non_essential)</span>
<span class="gi">+                    / sizeof(struct pad_conf_entry));</span>
<span class="gi">+</span>
<span class="gi">+}</span>
<span class="gi">+</span>
 #if !defined(CONFIG_SPL_BUILD) &amp;&amp; defined(CONFIG_GENERIC_MMC)
 int board_mmc_init(bd_t *bis)
 {
<span class="gh">diff --git a/board/ti/panda/panda_mux_data.h b/board/ti/panda/panda_mux_data.h</span>
<span class="gh">index 53c7080..11fcd32 100644</span>
<span class="gd">--- a/board/ti/panda/panda_mux_data.h</span>
<span class="gi">+++ b/board/ti/panda/panda_mux_data.h</span>
<span class="gu">@@ -78,10 +78,215 @@ const struct pad_conf_entry wkup_padconf_array_essential[] = {</span>

 };

<span class="gi">+//const struct pad_conf_entry wkup_padconf_array_essential_4460[] = {</span>
<span class="gi">+//</span>
<span class="gi">+//{PAD1_FREF_CLK4_REQ, (M3)}, /* gpio_wk7 for TPS: Mode 3 */</span>
<span class="gi">+//</span>
<span class="gi">+//};</span>
<span class="gi">+</span>
 const struct pad_conf_entry wkup_padconf_array_essential_4460[] = {

<span class="gd">-{PAD1_FREF_CLK4_REQ, (M3)}, /* gpio_wk7 for TPS: Mode 3 */</span>
<span class="gi">+{PAD1_FREF_CLK4_REQ, (PTU | M7)}, /* gpio_wk7 for TPS: safe mode + pull up */</span>
<span class="gi">+</span>
<span class="gi">+};</span>
<span class="gi">+</span>
<span class="gi">+const struct pad_conf_entry core_padconf_array_non_essential[] = {</span>
<span class="gi">+    {GPMC_AD8, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M3)},    /* gpio_32 */</span>
<span class="gi">+    {GPMC_AD9, (PTU | IEN | M3)},                   /* gpio_33 */</span>
<span class="gi">+    {GPMC_AD10, (PTU | IEN | M3)},                  /* gpio_34 */</span>
<span class="gi">+    {GPMC_AD11, (PTU | IEN | M3)},                  /* gpio_35 */</span>
<span class="gi">+    {GPMC_AD12, (PTU | IEN | M3)},                  /* gpio_36 */</span>
<span class="gi">+    {GPMC_AD13, (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M3)},    /* gpio_37 */</span>
<span class="gi">+    {GPMC_AD14, (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M3)},    /* gpio_38 */</span>
<span class="gi">+    {GPMC_AD15, (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M3)},    /* gpio_39 */</span>
<span class="gi">+    {GPMC_A16, (M3)},                       /* gpio_40 */</span>
<span class="gi">+    {GPMC_A17, (PTD | M3)},                     /* gpio_41 */</span>
<span class="gi">+    {GPMC_A18, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},    /* kpd_row6 */</span>
<span class="gi">+    {GPMC_A19, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},    /* kpd_row7 */</span>
<span class="gi">+    {GPMC_A20, (IEN | M3)},                     /* gpio_44 */</span>
<span class="gi">+    {GPMC_A21, (M3)},                       /* gpio_45 */</span>
<span class="gi">+    {GPMC_A22, (M3)},                       /* gpio_46 */</span>
<span class="gi">+    {GPMC_A23, (OFF_EN | OFF_PD | OFF_IN | M1)},            /* kpd_col7 */</span>
<span class="gi">+    {GPMC_A24, (PTD | M3)},                     /* gpio_48 */</span>
<span class="gi">+    {GPMC_A25, (PTD | M3)},                     /* gpio_49 */</span>
<span class="gi">+    {GPMC_NCS0, (M3)},                      /* gpio_50 */</span>
<span class="gi">+    {GPMC_NCS1, (IEN | M3)},                    /* gpio_51 */</span>
<span class="gi">+    {GPMC_NCS2, (IEN | M3)},                    /* gpio_52 */</span>
<span class="gi">+    {GPMC_NCS3, (IEN | M3)},                    /* gpio_53 */</span>
<span class="gi">+    {GPMC_NWP, (M3)},                       /* gpio_54 */</span>
<span class="gi">+    {GPMC_CLK, (PTD | M3)},                     /* gpio_55 */</span>
<span class="gi">+    {GPMC_NADV_ALE, (M3)},                      /* gpio_56 */</span>
<span class="gi">+    {GPMC_NBE0_CLE, (M3)},                      /* gpio_59 */</span>
<span class="gi">+    {GPMC_NBE1, (PTD | M3)},                    /* gpio_60 */</span>
<span class="gi">+    {GPMC_WAIT0, (PTU | IEN | M3)},                 /* gpio_61 */</span>
<span class="gi">+    {GPMC_WAIT1,  (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M3)},  /* gpio_62 */</span>
<span class="gi">+    {C2C_DATA11, (PTD | M3)},                   /* gpio_100 */</span>
<span class="gi">+    {C2C_DATA12, (PTU | IEN | M3)},                 /* gpio_101 */</span>
<span class="gi">+    {C2C_DATA13, (PTD | M3)},                   /* gpio_102 */</span>
<span class="gi">+    {C2C_DATA14, (M1)},                     /* dsi2_te0 */</span>
<span class="gi">+    {C2C_DATA15, (PTD | M3)},                   /* gpio_104 */</span>
<span class="gi">+    {HDMI_HPD, (M0)},                       /* hdmi_hpd */</span>
<span class="gi">+    {HDMI_CEC, (M0)},                       /* hdmi_cec */</span>
<span class="gi">+    {HDMI_DDC_SCL, (PTU | M0)},                 /* hdmi_ddc_scl */</span>
<span class="gi">+    {HDMI_DDC_SDA, (PTU | IEN | M0)},               /* hdmi_ddc_sda */</span>
<span class="gi">+    {CSI21_DX0, (IEN | M0)},                    /* csi21_dx0 */</span>
<span class="gi">+    {CSI21_DY0, (IEN | M0)},                    /* csi21_dy0 */</span>
<span class="gi">+    {CSI21_DX1, (IEN | M0)},                    /* csi21_dx1 */</span>
<span class="gi">+    {CSI21_DY1, (IEN | M0)},                    /* csi21_dy1 */</span>
<span class="gi">+    {CSI21_DX2, (IEN | M0)},                    /* csi21_dx2 */</span>
<span class="gi">+    {CSI21_DY2, (IEN | M0)},                    /* csi21_dy2 */</span>
<span class="gi">+    {CSI21_DX3, (PTD | M7)},                    /* csi21_dx3 */</span>
<span class="gi">+    {CSI21_DY3, (PTD | M7)},                    /* csi21_dy3 */</span>
<span class="gi">+    {CSI21_DX4, (PTD | OFF_EN | OFF_PD | OFF_IN | M7)},     /* csi21_dx4 */</span>
<span class="gi">+    {CSI21_DY4, (PTD | OFF_EN | OFF_PD | OFF_IN | M7)},     /* csi21_dy4 */</span>
<span class="gi">+    {CSI22_DX0, (IEN | M0)},                    /* csi22_dx0 */</span>
<span class="gi">+    {CSI22_DY0, (IEN | M0)},                    /* csi22_dy0 */</span>
<span class="gi">+    {CSI22_DX1, (IEN | M0)},                    /* csi22_dx1 */</span>
<span class="gi">+    {CSI22_DY1, (IEN | M0)},                    /* csi22_dy1 */</span>
<span class="gi">+    {CAM_SHUTTER, (OFF_EN | OFF_PD | OFF_OUT_PTD | M0)},        /* cam_shutter */</span>
<span class="gi">+    {CAM_STROBE, (OFF_EN | OFF_PD | OFF_OUT_PTD | M0)},     /* cam_strobe */</span>
<span class="gi">+    {CAM_GLOBALRESET, (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M3)},  /* gpio_83 */</span>
<span class="gi">+    {USBB1_ULPITLL_CLK, (IEN | OFF_EN | OFF_IN | M1)},      /* hsi1_cawake */</span>
<span class="gi">+    {USBB1_ULPITLL_STP, (IEN | OFF_EN | OFF_IN | M1)},      /* hsi1_cadata */</span>
<span class="gi">+    {USBB1_ULPITLL_DIR, (IEN | OFF_EN | OFF_IN | M1)},      /* hsi1_caflag */</span>
<span class="gi">+    {USBB1_ULPITLL_NXT, (OFF_EN | M1)},             /* hsi1_acready */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT0, (OFF_EN | M1)},                /* hsi1_acwake */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT1, (OFF_EN | M1)},                /* hsi1_acdata */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT2, (OFF_EN | M1)},                /* hsi1_acflag */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT3, (IEN | OFF_EN | OFF_IN | M1)},     /* hsi1_caready */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT4, (IEN | OFF_EN | OFF_PD | OFF_IN | M4)},    /* usbb1_ulpiphy_dat4 */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT5, (IEN | OFF_EN | OFF_PD | OFF_IN | M4)},    /* usbb1_ulpiphy_dat5 */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT6, (IEN | OFF_EN | OFF_PD | OFF_IN | M4)},    /* usbb1_ulpiphy_dat6 */</span>
<span class="gi">+    {USBB1_ULPITLL_DAT7, (IEN | OFF_EN | OFF_PD | OFF_IN | M4)},    /* usbb1_ulpiphy_dat7 */</span>
<span class="gi">+    {USBB1_HSIC_DATA, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},   /* usbb1_hsic_data */</span>
<span class="gi">+    {USBB1_HSIC_STROBE, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* usbb1_hsic_strobe */</span>
<span class="gi">+    {USBC1_ICUSB_DP, (IEN | M0)},                   /* usbc1_icusb_dp */</span>
<span class="gi">+    {USBC1_ICUSB_DM, (IEN | M0)},                   /* usbc1_icusb_dm */</span>
<span class="gi">+    {ABE_MCBSP2_DR, (IEN | OFF_EN | OFF_OUT_PTD | M0)},     /* abe_mcbsp2_dr */</span>
<span class="gi">+    {ABE_MCBSP2_DX, (OFF_EN | OFF_OUT_PTD | M0)},           /* abe_mcbsp2_dx */</span>
<span class="gi">+    {ABE_MCBSP2_FSX, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},    /* abe_mcbsp2_fsx */</span>
<span class="gi">+    {ABE_MCBSP1_CLKX, (IEN | M0)},                  /* abe_mcbsp1_clkx */</span>
<span class="gi">+    {ABE_MCBSP1_DR, (IEN | M0)},                    /* abe_mcbsp1_dr */</span>
<span class="gi">+    {ABE_MCBSP1_DX, (OFF_EN | OFF_OUT_PTD | M0)},           /* abe_mcbsp1_dx */</span>
<span class="gi">+    {ABE_MCBSP1_FSX, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},    /* abe_mcbsp1_fsx */</span>
<span class="gi">+    {ABE_PDM_UL_DATA, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* abe_pdm_ul_data */</span>
<span class="gi">+    {ABE_PDM_DL_DATA, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* abe_pdm_dl_data */</span>
<span class="gi">+    {ABE_PDM_FRAME, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},   /* abe_pdm_frame */</span>
<span class="gi">+    {ABE_PDM_LB_CLK, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},  /* abe_pdm_lb_clk */</span>
<span class="gi">+    {ABE_CLKS, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},    /* abe_clks */</span>
<span class="gi">+    {ABE_DMIC_CLK1, (M0)},                      /* abe_dmic_clk1 */</span>
<span class="gi">+    {ABE_DMIC_DIN1, (IEN | M0)},                    /* abe_dmic_din1 */</span>
<span class="gi">+    {ABE_DMIC_DIN2, (PTU | IEN | M3)},              /* gpio_121 */</span>
<span class="gi">+    {ABE_DMIC_DIN3, (IEN | M0)},                    /* abe_dmic_din3 */</span>
<span class="gi">+    {UART2_CTS, (PTU | IEN | M0)},                  /* uart2_cts */</span>
<span class="gi">+    {UART2_RTS, (M0)},                      /* uart2_rts */</span>
<span class="gi">+    {UART2_RX, (PTU | IEN | M0)},                   /* uart2_rx */</span>
<span class="gi">+    {UART2_TX, (M0)},                       /* uart2_tx */</span>
<span class="gi">+    {HDQ_SIO, (M3)},                        /* gpio_127 */</span>
<span class="gi">+    {MCSPI1_CLK, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},        /* mcspi1_clk */</span>
<span class="gi">+    {MCSPI1_SOMI, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},       /* mcspi1_somi */</span>
<span class="gi">+    {MCSPI1_SIMO, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},       /* mcspi1_simo */</span>
<span class="gi">+    {MCSPI1_CS0, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},  /* mcspi1_cs0 */</span>
<span class="gi">+    {MCSPI1_CS1, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M3)},  /* mcspi1_cs1 */</span>
<span class="gi">+    {MCSPI1_CS2, (PTU | OFF_EN | OFF_OUT_PTU | M3)},        /* gpio_139 */</span>
<span class="gi">+    {MCSPI1_CS3, (PTU | IEN | M3)},                 /* gpio_140 */</span>
<span class="gi">+    {SDMMC5_CLK, (PTU | IEN | OFF_EN | OFF_OUT_PTD | M0)},      /* sdmmc5_clk */</span>
<span class="gi">+    {SDMMC5_CMD, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},  /* sdmmc5_cmd */</span>
<span class="gi">+    {SDMMC5_DAT0, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* sdmmc5_dat0 */</span>
<span class="gi">+    {SDMMC5_DAT1, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* sdmmc5_dat1 */</span>
<span class="gi">+    {SDMMC5_DAT2, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* sdmmc5_dat2 */</span>
<span class="gi">+    {SDMMC5_DAT3, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M0)}, /* sdmmc5_dat3 */</span>
<span class="gi">+    {MCSPI4_CLK, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},        /* mcspi4_clk */</span>
<span class="gi">+    {MCSPI4_SIMO, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},       /* mcspi4_simo */</span>
<span class="gi">+    {MCSPI4_SOMI, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},       /* mcspi4_somi */</span>
<span class="gi">+    {MCSPI4_CS0, (PTD | IEN | OFF_EN | OFF_PD | OFF_IN | M0)},  /* mcspi4_cs0 */</span>
<span class="gi">+    {UART4_RX, (IEN | M0)},                     /* uart4_rx */</span>
<span class="gi">+    {UART4_TX, (M0)},                       /* uart4_tx */</span>
<span class="gi">+    {USBB2_ULPITLL_CLK, (IEN | M3)},                /* gpio_157 */</span>
<span class="gi">+    {USBB2_ULPITLL_STP, (IEN | M5)},                /* dispc2_data23 */</span>
<span class="gi">+    {USBB2_ULPITLL_DIR, (IEN | M5)},                /* dispc2_data22 */</span>
<span class="gi">+    {USBB2_ULPITLL_NXT, (IEN | M5)},                /* dispc2_data21 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT0, (IEN | M5)},               /* dispc2_data20 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT1, (IEN | M5)},               /* dispc2_data19 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT2, (IEN | M5)},               /* dispc2_data18 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT3, (IEN | M5)},               /* dispc2_data15 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT4, (IEN | M5)},               /* dispc2_data14 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT5, (IEN | M5)},               /* dispc2_data13 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT6, (IEN | M5)},               /* dispc2_data12 */</span>
<span class="gi">+    {USBB2_ULPITLL_DAT7, (IEN | M5)},               /* dispc2_data11 */</span>
<span class="gi">+    {USBB2_HSIC_DATA, (PTD | OFF_EN | OFF_OUT_PTU | M3)},       /* gpio_169 */</span>
<span class="gi">+    {USBB2_HSIC_STROBE, (PTD | OFF_EN | OFF_OUT_PTU | M3)},     /* gpio_170 */</span>
<span class="gi">+    {UNIPRO_TX0, (PTD | IEN | M3)},                 /* gpio_171 */</span>
<span class="gi">+    {UNIPRO_TY0, (OFF_EN | OFF_PD | OFF_IN | M1)},          /* kpd_col1 */</span>
<span class="gi">+    {UNIPRO_TX1, (OFF_EN | OFF_PD | OFF_IN | M1)},          /* kpd_col2 */</span>
<span class="gi">+    {UNIPRO_TY1, (OFF_EN | OFF_PD | OFF_IN | M1)},          /* kpd_col3 */</span>
<span class="gi">+    {UNIPRO_TX2, (PTU | IEN | M3)},                 /* gpio_0 */</span>
<span class="gi">+    {UNIPRO_TY2, (PTU | IEN | M3)},                 /* gpio_1 */</span>
<span class="gi">+    {UNIPRO_RX0, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row0 */</span>
<span class="gi">+    {UNIPRO_RY0, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row1 */</span>
<span class="gi">+    {UNIPRO_RX1, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row2 */</span>
<span class="gi">+    {UNIPRO_RY1, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row3 */</span>
<span class="gi">+    {UNIPRO_RX2, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row4 */</span>
<span class="gi">+    {UNIPRO_RY2, (PTU | IEN | OFF_EN | OFF_PD | OFF_IN | M1)},  /* kpd_row5 */</span>
<span class="gi">+    {USBA0_OTG_CE, (PTD | OFF_EN | OFF_PD | OFF_OUT_PTD | M0)}, /* usba0_otg_ce */</span>
<span class="gi">+    {USBA0_OTG_DP, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},      /* usba0_otg_dp */</span>
<span class="gi">+    {USBA0_OTG_DM, (IEN | OFF_EN | OFF_PD | OFF_IN | M0)},      /* usba0_otg_dm */</span>
<span class="gi">+    {FREF_CLK1_OUT, (M0)},                      /* fref_clk1_out */</span>
<span class="gi">+    {FREF_CLK2_OUT, (PTU | IEN | M3)},              /* gpio_182 */</span>
<span class="gi">+    {SYS_NIRQ1, (PTU | IEN | M0)},                  /* sys_nirq1 */</span>
<span class="gi">+    {SYS_NIRQ2, (PTU | IEN | M0)},                  /* sys_nirq2 */</span>
<span class="gi">+    {SYS_BOOT0, (PTU | IEN | M3)},                  /* gpio_184 */</span>
<span class="gi">+    {SYS_BOOT1, (M3)},                      /* gpio_185 */</span>
<span class="gi">+    {SYS_BOOT2, (PTD | IEN | M3)},                  /* gpio_186 */</span>
<span class="gi">+    {SYS_BOOT3, (M3)},                      /* gpio_187 */</span>
<span class="gi">+    {SYS_BOOT4, (M3)},                      /* gpio_188 */</span>
<span class="gi">+    {SYS_BOOT5, (PTD | IEN | M3)},                  /* gpio_189 */</span>
<span class="gi">+    {DPM_EMU0, (IEN | M0)},                     /* dpm_emu0 */</span>
<span class="gi">+    {DPM_EMU1, (IEN | M0)},                     /* dpm_emu1 */</span>
<span class="gi">+    {DPM_EMU2, (IEN | M0)},                     /* dpm_emu2 */</span>
<span class="gi">+    {DPM_EMU3, (IEN | M5)},                     /* dispc2_data10 */</span>
<span class="gi">+    {DPM_EMU4, (IEN | M5)},                     /* dispc2_data9 */</span>
<span class="gi">+    {DPM_EMU5, (IEN | M5)},                     /* dispc2_data16 */</span>
<span class="gi">+    {DPM_EMU6, (IEN | M5)},                     /* dispc2_data17 */</span>
<span class="gi">+    {DPM_EMU7, (IEN | M5)},                     /* dispc2_hsync */</span>
<span class="gi">+    {DPM_EMU8, (IEN | M5)},                     /* dispc2_pclk */</span>
<span class="gi">+    {DPM_EMU9, (IEN | M5)},                     /* dispc2_vsync */</span>
<span class="gi">+    {DPM_EMU10, (IEN | M5)},                    /* dispc2_de */</span>
<span class="gi">+    {DPM_EMU11, (IEN | M5)},                    /* dispc2_data8 */</span>
<span class="gi">+    {DPM_EMU12, (IEN | M5)},                    /* dispc2_data7 */</span>
<span class="gi">+    {DPM_EMU13, (IEN | M5)},                    /* dispc2_data6 */</span>
<span class="gi">+    {DPM_EMU14, (IEN | M5)},                    /* dispc2_data5 */</span>
<span class="gi">+    {DPM_EMU15, (IEN | M5)},                    /* dispc2_data4 */</span>
<span class="gi">+    {DPM_EMU16, (M3)},                      /* gpio_27 */</span>
<span class="gi">+    {DPM_EMU17, (IEN | M5)},                    /* dispc2_data2 */</span>
<span class="gi">+    {DPM_EMU18, (IEN | M5)},                    /* dispc2_data1 */</span>
<span class="gi">+    {DPM_EMU19, (IEN | M5)},                    /* dispc2_data0 */</span>
<span class="gi">+};</span>
<span class="gi">+</span>
<span class="gi">+const struct pad_conf_entry core_padconf_array_non_essential_4460[] = {</span>
<span class="gi">+    {ABE_MCBSP2_CLKX, (PTU | OFF_EN | OFF_OUT_PTU | M3)},       /* led status_1 */</span>
<span class="gi">+};</span>

<span class="gi">+const struct pad_conf_entry wkup_padconf_array_non_essential[] = {</span>
<span class="gi">+    {PAD0_SIM_IO, (IEN | M0)},      /* sim_io */</span>
<span class="gi">+    {PAD1_SIM_CLK, (M0)},           /* sim_clk */</span>
<span class="gi">+    {PAD0_SIM_RESET, (M0)},         /* sim_reset */</span>
<span class="gi">+    {PAD1_SIM_CD, (PTU | IEN | M0)},    /* sim_cd */</span>
<span class="gi">+    {PAD0_SIM_PWRCTRL, (M0)},       /* sim_pwrctrl */</span>
<span class="gi">+    {PAD1_FREF_XTAL_IN, (M0)},      /* # */</span>
<span class="gi">+    {PAD0_FREF_SLICER_IN, (M0)},        /* fref_slicer_in */</span>
<span class="gi">+    {PAD1_FREF_CLK_IOREQ, (M0)},        /* fref_clk_ioreq */</span>
<span class="gi">+    {PAD0_FREF_CLK0_OUT, (M2)},     /* sys_drm_msecure */</span>
<span class="gi">+    {PAD1_FREF_CLK3_REQ, M7},       /* safe mode */</span>
<span class="gi">+    {PAD0_FREF_CLK3_OUT, (M0)},     /* fref_clk3_out */</span>
<span class="gi">+    {PAD0_FREF_CLK4_OUT, (PTU | M3)},   /* led status_2 */</span>
<span class="gi">+    {PAD0_SYS_NRESPWRON, (M0)},     /* sys_nrespwron */</span>
<span class="gi">+    {PAD1_SYS_NRESWARM, (M0)},      /* sys_nreswarm */</span>
<span class="gi">+    {PAD0_SYS_PWR_REQ, (PTU | M0)},     /* sys_pwr_req */</span>
<span class="gi">+    {PAD1_SYS_PWRON_RESET, (M3)},       /* gpio_wk29 */</span>
<span class="gi">+    {PAD0_SYS_BOOT6, (IEN | M3)},       /* gpio_wk9 */</span>
<span class="gi">+    {PAD1_SYS_BOOT7, (IEN | M3)},       /* gpio_wk10 */</span>
 };

<span class="gi">+</span>
 #endif /* _PANDA_MUX_DATA_H_ */
</pre></div>


<p>大功告成, 再配置一下gpio, 问题解决!  </p>
            </div><!-- /.entry-content -->
			
			
			<ul style="float:right;">
				<li>
					◄&nbsp;&nbsp;<a href="http://blog.kfatso.com/articles/2015/08/15/pandaboard-bootload-process/">
						Pandaboard bootload(uboot) 启动流程探究
					</a>
				</li>
				<li>
					►&nbsp;&nbsp;<a href="http://blog.kfatso.com/articles/2016/07/17/pandaboard-zhong-duan-liu-cheng-he-zhong-duan-fu-wu-han-shu/">
						Pandaboard 中断流程和中断服务函数
					</a>
				</li>
			</ul>
			
			
            <div class="comments">
              <h3>Comments</h3>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_identifier = "articles/2016/01/31/enable-nonessential-clk-gpio/";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://kgat96.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              </script>
            </div>


        </div><!-- /.eleven.columns -->

<div class="three columns">

<div class="sidebarbg">
	<h4>Pages</h4>
	<ul>
		  <li><a href="/functions/tags.html">Tags</a></li>
		  <li><a href="/functions/archives.html">Archives</a></li>
	</ul>
</div>




<div class="social sidebarbg">
	<nav class="widget">
	  <h4>Social</h4>
	  <ul>
		<li><a target="_blank" href="https://github.com/">GitHub</a></li>
		<li><a target="_blank" href="https://www.facebook.com/">FaceBook</a></li>
	  </ul>
	</nav>
</div>

<nav class="widget sidebarbg">
  <h4>Links</h4>
  <ul>
	<li><a target="_blank" href="http://getpelican.com/">Pelican</a></li>
	<li><a target="_blank" href="http://python.org/">Python.org</a></li>
  </ul>
</nav>

</div> </div><!-- /.row -->


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    <br />
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">

                <li><div class="btn primary"><a href="https://github.com/" target="_blank">Github</a></div></li>


                <li><div class="btn facebook"><a href="https://www.facebook.com/" target="_blank">Facebook</a></div></li>


              </ul>
            </div>
          </div>
        </footer>

    </div>


<script type="text/javascript">
    var disqus_shortname = 'kgat96';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script src="http://blog.kfatso.com/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="http://blog.kfatso.com/theme/js/libs/gumby.min.js"></script>
  <script src="http://blog.kfatso.com/theme/js/plugins.js"></script>
	<script>
	(function() {
		var $backToTopTxt = "返回顶部", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
			.text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
				$("html, body").animate({ scrollTop: 0 }, 120);
		}), $backToTopFun = function() {
			var st = $(document).scrollTop(), winh = $(window).height();
			(st > 0)? $backToTopEle.show(): $backToTopEle.hide();
			//IE6下的定位
			if (!window.XMLHttpRequest) {
				$backToTopEle.css("top", st + winh - 166);
			}
		};
		$(window).bind("scroll", $backToTopFun);
		$(function() { $backToTopFun(); });
	})();
	</script>
</body>
</html>